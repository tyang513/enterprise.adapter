<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.td.admin.mapper.SysOaInstanceMapper" >
  <resultMap id="BaseResultMap" type="com.td.admin.entity.SysOaInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    
    <result column="fatherPIName" property="fatherPIName" jdbcType="VARCHAR" />
    <result column="templateName" property="templateName" jdbcType="VARCHAR" />
    <result column="statusName" property="statusName" jdbcType="VARCHAR" />
    
    <result column="templateCode" property="templatecode" jdbcType="VARCHAR" />
    <result column="activitiProcessInstanceId" property="activitiprocessinstanceid" jdbcType="VARCHAR" />
    <result column="fatherProcessInstnaceId" property="fatherprocessinstnaceid" jdbcType="BIGINT" />
    <result column="templateType" property="templatetype" jdbcType="INTEGER" />
    <result column="startTime" property="starttime" jdbcType="TIMESTAMP" />
    <result column="starterUmId" property="starterumid" jdbcType="VARCHAR" />
    <result column="starterName" property="startername" jdbcType="VARCHAR" />
    <result column="title" property="title" jdbcType="VARCHAR" />
    <result column="content" property="content" jdbcType="VARCHAR" />
    <result column="endTime" property="endtime" jdbcType="TIMESTAMP" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="MTime" property="mtime" jdbcType="TIMESTAMP" />
    <result column="CTime" property="ctime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    id, templateCode, activitiProcessInstanceId, fatherProcessInstnaceId, templateType, 
    startTime, starterUmId, starterName, title, content, endTime, status, MTime, CTime
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    select 
    <include refid="Base_Column_List" />
    from SYS_OA_INSTANCE
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    delete from SYS_OA_INSTANCE
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.td.admin.entity.SysOaInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    insert into SYS_OA_INSTANCE (id, templateCode, activitiProcessInstanceId, 
      fatherProcessInstnaceId, templateType, startTime, 
      starterUmId, starterName, title, 
      content, endTime, status, 
      MTime, CTime)
    values (#{id,jdbcType=BIGINT}, #{templatecode,jdbcType=VARCHAR}, #{activitiprocessinstanceid,jdbcType=VARCHAR}, 
      #{fatherprocessinstnaceid,jdbcType=BIGINT}, #{templatetype,jdbcType=INTEGER}, #{starttime,jdbcType=TIMESTAMP}, 
      #{starterumid,jdbcType=VARCHAR}, #{startername,jdbcType=VARCHAR}, #{title,jdbcType=VARCHAR}, 
      #{content,jdbcType=VARCHAR}, #{endtime,jdbcType=TIMESTAMP}, #{status,jdbcType=INTEGER}, 
      #{mtime,jdbcType=TIMESTAMP}, #{ctime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.td.admin.entity.SysOaInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    insert into SYS_OA_INSTANCE
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="templatecode != null" >
        templateCode,
      </if>
      <if test="activitiprocessinstanceid != null" >
        activitiProcessInstanceId,
      </if>
      <if test="fatherprocessinstnaceid != null" >
        fatherProcessInstnaceId,
      </if>
      <if test="templatetype != null" >
        templateType,
      </if>
      <if test="starttime != null" >
        startTime,
      </if>
      <if test="starterumid != null" >
        starterUmId,
      </if>
      <if test="startername != null" >
        starterName,
      </if>
      <if test="title != null" >
        title,
      </if>
      <if test="content != null" >
        content,
      </if>
      <if test="endtime != null" >
        endTime,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="mtime != null" >
        MTime,
      </if>
      <if test="ctime != null" >
        CTime,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="templatecode != null" >
        #{templatecode,jdbcType=VARCHAR},
      </if>
      <if test="activitiprocessinstanceid != null" >
        #{activitiprocessinstanceid,jdbcType=VARCHAR},
      </if>
      <if test="fatherprocessinstnaceid != null" >
        #{fatherprocessinstnaceid,jdbcType=BIGINT},
      </if>
      <if test="templatetype != null" >
        #{templatetype,jdbcType=INTEGER},
      </if>
      <if test="starttime != null" >
        #{starttime,jdbcType=TIMESTAMP},
      </if>
      <if test="starterumid != null" >
        #{starterumid,jdbcType=VARCHAR},
      </if>
      <if test="startername != null" >
        #{startername,jdbcType=VARCHAR},
      </if>
      <if test="title != null" >
        #{title,jdbcType=VARCHAR},
      </if>
      <if test="content != null" >
        #{content,jdbcType=VARCHAR},
      </if>
      <if test="endtime != null" >
        #{endtime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="mtime != null" >
        #{mtime,jdbcType=TIMESTAMP},
      </if>
      <if test="ctime != null" >
        #{ctime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.td.admin.entity.SysOaInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    update SYS_OA_INSTANCE
    <set >
      <if test="templatecode != null" >
        templateCode = #{templatecode,jdbcType=VARCHAR},
      </if>
      <if test="activitiprocessinstanceid != null" >
        activitiProcessInstanceId = #{activitiprocessinstanceid,jdbcType=VARCHAR},
      </if>
      <if test="fatherprocessinstnaceid != null" >
        fatherProcessInstnaceId = #{fatherprocessinstnaceid,jdbcType=BIGINT},
      </if>
      <if test="templatetype != null" >
        templateType = #{templatetype,jdbcType=INTEGER},
      </if>
      <if test="starttime != null" >
        startTime = #{starttime,jdbcType=TIMESTAMP},
      </if>
      <if test="starterumid != null" >
        starterUmId = #{starterumid,jdbcType=VARCHAR},
      </if>
      <if test="startername != null" >
        starterName = #{startername,jdbcType=VARCHAR},
      </if>
      <if test="title != null" >
        title = #{title,jdbcType=VARCHAR},
      </if>
      <if test="content != null" >
        content = #{content,jdbcType=VARCHAR},
      </if>
      <if test="endtime != null" >
        endTime = #{endtime,jdbcType=TIMESTAMP},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="mtime != null" >
        MTime = #{mtime,jdbcType=TIMESTAMP},
      </if>
      <if test="ctime != null" >
        CTime = #{ctime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.td.admin.entity.SysOaInstance" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    update SYS_OA_INSTANCE
    set templateCode = #{templatecode,jdbcType=VARCHAR},
      activitiProcessInstanceId = #{activitiprocessinstanceid,jdbcType=VARCHAR},
      fatherProcessInstnaceId = #{fatherprocessinstnaceid,jdbcType=BIGINT},
      templateType = #{templatetype,jdbcType=INTEGER},
      startTime = #{starttime,jdbcType=TIMESTAMP},
      starterUmId = #{starterumid,jdbcType=VARCHAR},
      starterName = #{startername,jdbcType=VARCHAR},
      title = #{title,jdbcType=VARCHAR},
      content = #{content,jdbcType=VARCHAR},
      endTime = #{endtime,jdbcType=TIMESTAMP},
      status = #{status,jdbcType=INTEGER},
      MTime = #{mtime,jdbcType=TIMESTAMP},
      CTime = #{ctime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
    <select id="findCount" parameterType="com.td.admin.entity.SysOaInstance" resultType="java.lang.Integer">
  	select count(*) from  SYS_OA_INSTANCE
  	where 1 = 1
  	  <if test="title != null and title != ''">
       AND title like '%${title}%'
      </if>
      <if test="templatetype != null and templatetype != ''">
       AND templatetype = #{templatetype,jdbcType=INTEGER}
      </if>
      <if test="status!=null and status!=''">
       AND status=#{status,jdbcType=INTEGER}
      </if> 
      <if test="starttime != null">
		and startTime &gt;= #{starttime,jdbcType=TIMESTAMP}
		</if>
		<if test="findStartTime != null">
			and startTime &lt;= date_format(#{findStartTime,jdbcType=TIMESTAMP},'%Y-%c-%d 23:59:59') 
		</if>
		<if test="endtime != null">
			and endtime &gt;= #{endtime,jdbcType=TIMESTAMP}
		</if>
		<if test="findEndTime != null">
			and endtime &lt;= date_format(#{findEndTime,jdbcType=TIMESTAMP},'%Y-%c-%d 23:59:59') 
		</if>
  </select>
  <select id="find" parameterType="com.td.admin.entity.SysOaInstance" resultMap="BaseResultMap">
  	select <include refid="Base_Column_List" />,
		(select processName from PROCESS_INSTANCE where id = fatherProcessInstnaceId)as fatherPIName,
		(select `name` from OA_OATEMPLATE where `code`=templateCode) as templateName,
		(select dicItemValue from SYS_DIC_ITEM where dicId=
			(select `id` from SYS_DIC where name='oaInstanceStatus') and dicItemKey=SYS_OA_INSTANCE.`status`) as statusName
  	from SYS_OA_INSTANCE 
  	where 1 = 1
  	   <if test="title != null and title != ''">
       AND title like '%${title}%'
      </if>
      <if test="templatetype != null and templatetype != ''">
       AND templatetype = #{templatetype,jdbcType=INTEGER}
      </if>
      <if test="status!=null and status!=''">
       AND status=#{status,jdbcType=INTEGER}
      </if>
      <if test="starttime != null">
		and startTime &gt;= #{starttime,jdbcType=TIMESTAMP}
		</if>
		<if test="findStartTime != null">
			and startTime &lt;= date_format(#{findStartTime,jdbcType=TIMESTAMP},'%Y-%c-%d 23:59:59') 
		</if>
		<if test="endtime != null">
			and endtime &gt;= #{endtime,jdbcType=TIMESTAMP}
		</if>
		<if test="findEndTime != null">
			and endtime &lt;= date_format(#{findEndTime,jdbcType=TIMESTAMP},'%Y-%c-%d 23:59:59') 
		</if>
		order by starttime desc
      limit #{beginIndex,jdbcType=BIGINT},#{numPerPage,jdbcType=BIGINT}
  </select>
  
  
  <select id="getOainstance" parameterType="java.util.Map" resultMap="BaseResultMap">
  	select <include refid="Base_Column_List"/> from SYS_OA_INSTANCE where 
  	fatherProcessInstnaceId = #{fid,jdbcType=BIGINT} and endTime is null
  </select>
  <select id="queryOainstance" parameterType="com.td.admin.entity.SysOaInstance" resultMap="BaseResultMap">
  	select <include refid="Base_Column_List"/> from SYS_OA_INSTANCE where 
  	fatherProcessInstnaceId = #{fatherprocessinstnaceid,jdbcType=BIGINT} and templateCode = #{templatecode,jdbcType=VARCHAR}
  </select>
  
</mapper>