<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.td.admin.mapper.SysTakeoverMapper" >
  <resultMap id="BaseResultMap" type="com.td.admin.entity.SysTakeover" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 13 14:35:10 CST 2013.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="userUmId" property="userumid" jdbcType="VARCHAR" />
    <result column="targetUserUmId" property="targetuserumid" jdbcType="VARCHAR" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="startTime" property="starttime" jdbcType="TIMESTAMP" />
    <result column="endtime" property="endtime" jdbcType="TIMESTAMP" />
    <result column="MTime" property="mtime" jdbcType="TIMESTAMP" />
    <result column="CTime" property="ctime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 13 14:35:10 CST 2013.
    -->
    id, userUmId, targetUserUmId,type, startTime, endtime, MTime, CTime
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 13 14:35:10 CST 2013.
    -->
    select 
    <include refid="Base_Column_List" />
    from SYS_TAKEOVER
    where id = #{id,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 13 14:35:10 CST 2013.
    -->
    delete from SYS_TAKEOVER
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.td.admin.entity.SysTakeover" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 13 14:35:10 CST 2013.
    -->
    insert into SYS_TAKEOVER (id, userUmId, targetUserUmId, type,
      startTime, endtime, MTime, 
      CTime)
    values (#{id,jdbcType=BIGINT}, #{userumid,jdbcType=VARCHAR}, #{targetuserumid,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR}, 
      #{starttime,jdbcType=TIMESTAMP}, #{endtime,jdbcType=TIMESTAMP}, #{mtime,jdbcType=TIMESTAMP}, 
      #{ctime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.td.admin.entity.SysTakeover" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 13 14:35:10 CST 2013.
    -->
    insert into SYS_TAKEOVER
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="userumid != null" >
        userUmId,
      </if>
      <if test="targetuserumid != null" >
        targetUserUmId,
      </if>
       <if test="type != null" >
        type,
      </if>
      <if test="starttime != null" >
        startTime,
      </if>
      <if test="endtime != null" >
        endtime,
      </if>
      <if test="mtime != null" >
        MTime,
      </if>
      <if test="ctime != null" >
        CTime,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="userumid != null" >
        #{userumid,jdbcType=VARCHAR},
      </if>
      <if test="targetuserumid != null" >
        #{targetuserumid,jdbcType=VARCHAR},
      </if>
       <if test="type != null" >
        #{type,jdbcType=VARCHAR},
      </if>
      <if test="starttime != null" >
        #{starttime,jdbcType=TIMESTAMP},
      </if>
      <if test="endtime != null" >
        #{endtime,jdbcType=TIMESTAMP},
      </if>
      <if test="mtime != null" >
        #{mtime,jdbcType=TIMESTAMP},
      </if>
      <if test="ctime != null" >
        #{ctime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.td.admin.entity.SysTakeover" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 13 14:35:10 CST 2013.
    -->
    update SYS_TAKEOVER
    <set >
      <if test="userumid != null" >
        userUmId = #{userumid,jdbcType=VARCHAR},
      </if>
      <if test="targetuserumid != null" >
        targetUserUmId = #{targetuserumid,jdbcType=VARCHAR},
      </if>
       <if test="type != null" >
        type = #{type,jdbcType=VARCHAR},
      </if>
      <if test="starttime != null" >
        startTime = #{starttime,jdbcType=TIMESTAMP},
      </if>
      <if test="endtime != null" >
        endtime = #{endtime,jdbcType=TIMESTAMP},
      </if>
      <if test="mtime != null" >
        MTime = #{mtime,jdbcType=TIMESTAMP},
      </if>
      <if test="ctime != null" >
        CTime = #{ctime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.td.admin.entity.SysTakeover" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 13 14:35:10 CST 2013.
    -->
    update SYS_TAKEOVER
    set userUmId = #{userumid,jdbcType=VARCHAR},
      targetUserUmId = #{targetuserumid,jdbcType=VARCHAR},
      type = #{type,jdbcType=VARCHAR},
      startTime = #{starttime,jdbcType=TIMESTAMP},
      endtime = #{endtime,jdbcType=TIMESTAMP},
      MTime = #{mtime,jdbcType=TIMESTAMP},
      CTime = #{ctime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  <resultMap id="BaseResultMapExtends" type="com.td.admin.entity.SysTakeoverExtends" >
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="userUmId" property="userumid" jdbcType="VARCHAR" />
    <result column="targetUserUmId" property="targetuserumid" jdbcType="VARCHAR" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="startTime" property="starttime" jdbcType="TIMESTAMP" />
    <result column="endtime" property="endtime" jdbcType="TIMESTAMP" />
    <result column="MTime" property="mtime" jdbcType="TIMESTAMP" />
    <result column="CTime" property="ctime" jdbcType="TIMESTAMP" />
    <result column="username" property="username" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="targetUsername" property="targetUsername" jdbcType="VARCHAR" />
    <result column="targetEmail" property="targetEmail" jdbcType="VARCHAR" />   
  </resultMap>  
  <sql id="Base_Column_List_Extends" >
    id, userUmId, targetUserUmId,type, startTime, endtime, MTime, CTime ,'' username,'' email,'' targetUsername,'' targetEmail
  </sql>  
  <select id="selectByUmid" resultMap="BaseResultMapExtends" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List_Extends" />
    from SYS_TAKEOVER
    where userUmId = #{userumid,jdbcType=VARCHAR}
    order by startTime desc
  </select>
  <select id="selectByUmidOrTargetUmid" resultMap="BaseResultMapExtends" parameterType="com.td.admin.entity.SysTakeover" >
    select 
    <include refid="Base_Column_List_Extends" />
      from SYS_TAKEOVER
    <where>
      <if test="userumid != null and userumid != ''" >
        and userUmId  LIKE CONCAT(CONCAT('%', #{userumid,jdbcType=VARCHAR}),'%')
      </if>
      <if test="targetuserumid != null and targetuserumid != '' " >
        and targetUserUmId LIKE CONCAT(CONCAT('%', #{targetuserumid,jdbcType=VARCHAR}),'%')
      </if>
    </where> 
  </select>
  <select id="selectByBusinessKey" resultMap="BaseResultMapExtends" parameterType="com.td.admin.entity.SysTakeover" >
    select 
    <include refid="Base_Column_List_Extends" />
      from SYS_TAKEOVER
    <where>
      <if test="userumid != null and userumid != ''" >
        and userUmId = #{userumid,jdbcType=VARCHAR}
      </if>
      <if test="targetuserumid != null and targetuserumid != ''" >
        and targetUserUmId = #{targetuserumid,jdbcType=VARCHAR}
      </if>
      <if test="starttime != null" >
        and startTime = #{starttime,jdbcType=TIMESTAMP}
      </if>
      <if test="endtime != null" >
        and endtime = #{endtime,jdbcType=TIMESTAMP}
      </if>
      <if test="mtime != null" >
        and MTime = #{mtime,jdbcType=TIMESTAMP}
      </if>
      <if test="ctime != null" >
        and CTime = #{ctime,jdbcType=TIMESTAMP}
      </if>
    </where> 
  </select>
  <!-- 按条件分页查询(结果集) -->
  <select id="selectByConditionsPagely" resultMap="BaseResultMapExtends" parameterType="map" >
    select 
    <include refid="Base_Column_List_Extends" />
      from SYS_TAKEOVER
    <where>
      <if test="userumid != null and userumid != ''" >
        and userUmId  LIKE CONCAT(CONCAT('%', #{userumid,jdbcType=VARCHAR}),'%')
      </if>
      <if test="targetuserumid != null and targetuserumid != '' " >
        and targetUserUmId LIKE CONCAT(CONCAT('%', #{targetuserumid,jdbcType=VARCHAR}),'%')
      </if>
      <if test="inUserUmid != null and inUserUmid != ''" >
        and userUmId in (${inUserUmid})
      </if>
      <if test="inTargetUserUmid != null and inTargetUserUmid != '' " >
        and targetUserUmId in (${inTargetUserUmid})
      </if>
      <if test="starttime != null" >
        and startTime <![CDATA[ >= ]]> #{starttime,jdbcType=TIMESTAMP}
      </if>
      <if test="endtime != null" >
        and endtime <![CDATA[ <= ]]> #{endtime,jdbcType=TIMESTAMP}
      </if>
    </where>
    <if test="sort != null and sort != ''" >
      order by ${sort} ${order} 
    </if>
    <if test="limitStart != null" >
      limit #{limitStart,jdbcType=INTEGER},#{pageRows,jdbcType=INTEGER}
    </if>
  </select> 
  <!-- 按条件分页查询(总记录数) -->
  <select id="selectTotalCountByConditions" resultType="_int" parameterType="map" >
    select count(*) cnt
      from SYS_TAKEOVER
    <where>
      <if test="userumid != null and userumid != ''" >
        and userUmId  LIKE CONCAT(CONCAT('%', #{userumid,jdbcType=VARCHAR}),'%')
      </if>
      <if test="targetuserumid != null and targetuserumid != '' " >
        and targetUserUmId LIKE CONCAT(CONCAT('%', #{targetuserumid,jdbcType=VARCHAR}),'%')
      </if>
       <if test="inUserUmid != null and inUserUmid != ''" >
        and userUmId in (${inUserUmid})
      </if>
      <if test="inTargetUserUmid != null and inTargetUserUmid != '' " >
        and targetUserUmId in (${inTargetUserUmid})
      </if>
      <if test="starttime != null" >
        and startTime <![CDATA[ >= ]]> #{starttime,jdbcType=TIMESTAMP}
      </if>
      <if test="endtime != null" >
        and endtime <![CDATA[ <= ]]> #{endtime,jdbcType=TIMESTAMP}
      </if>
    </where> 
  </select>

  <!-- 查询用户的接管者 -->
  <select id="getTakeoverUsers" resultMap="BaseResultMapExtends" parameterType="map" >
    select 
    <include refid="Base_Column_List_Extends" />
      from SYS_TAKEOVER
    <where>
      <if test="userumid != null and userumid != ''" >
        and userUmId  = #{userumid,jdbcType=VARCHAR}
      </if>
      <if test="currentTime != null" >
        and startTime <![CDATA[ <= ]]> #{currentTime,jdbcType=TIMESTAMP}
        and endtime <![CDATA[ >= ]]> #{currentTime,jdbcType=TIMESTAMP}
      </if>
    </where>
    <if test="sort != null and sort != ''" >
      order by ${sort} ${order} 
    </if>
    <if test="limitStart != null" >
      limit #{limitStart,jdbcType=INTEGER},#{pageRows,jdbcType=INTEGER}
    </if>
  </select>
  
  <select id="selectUserByTime" resultType="_int" parameterType="com.td.admin.entity.SysTakeover" >
    select count(*)
      from SYS_TAKEOVER
    <where>
      <if test="userumid != null and userumid != '' " >
       and (targetUserUmId = #{targetuserumid,jdbcType=VARCHAR} 
       	or userumid = #{userumid,jdbcType=VARCHAR})
      </if>
      <if test="starttime != null and endtime !=null " >
       and ((startTime <![CDATA[ <= ]]>  #{starttime,jdbcType=TIMESTAMP} 
       and endtime <![CDATA[ >= ]]> #{starttime,jdbcType=TIMESTAMP})
       or (startTime <![CDATA[ <= ]]> #{endtime,jdbcType=TIMESTAMP} 
       and endtime <![CDATA[ >= ]]> #{endtime,jdbcType=TIMESTAMP}))
      </if>
    </where> 
  </select>
   <select id="selectTakeOverUserByTime" resultType="_int" parameterType="com.td.admin.entity.SysTakeover" >
    select count(*)
      from SYS_TAKEOVER
    <where>
      <if test="targetuserumid != null and targetuserumid != '' " >
       and userUmId = #{targetuserumid,jdbcType=VARCHAR}
      </if>
      <if test="starttime != null and endtime !=null " >
       and ((startTime <![CDATA[ <= ]]>  #{starttime,jdbcType=TIMESTAMP} 
       and endtime <![CDATA[ >= ]]> #{starttime,jdbcType=TIMESTAMP})
       or (startTime <![CDATA[ <= ]]> #{endtime,jdbcType=TIMESTAMP} 
       and endtime <![CDATA[ >= ]]> #{endtime,jdbcType=TIMESTAMP}))
      </if>
    </where> 
  </select>
  
  <select id="findAccreditUserByUmid" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from SYS_TAKEOVER
    where targetUserUmId = #{targetUserUmId,jdbcType=VARCHAR}
    	and TO_DAYS(CURRENT_TIMESTAMP) &gt;= TO_DAYS(startTime) 
    	and TO_DAYS(CURRENT_TIMESTAMP) &lt;= TO_DAYS(endtime)
  </select>
  
  
</mapper>