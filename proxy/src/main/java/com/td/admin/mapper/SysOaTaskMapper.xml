<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.td.admin.mapper.SysOaTaskMapper" >
  <resultMap id="BaseResultMap" type="com.td.admin.entity.SysOaTask" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="instanceId" property="instanceid" jdbcType="BIGINT" />
    <result column="instanceName" property="instancename" jdbcType="VARCHAR" />
    <result column="taskId" property="taskid" jdbcType="BIGINT" />
    <result column="taskCode" property="taskcode" jdbcType="VARCHAR" />
    <result column="taskName" property="taskname" jdbcType="VARCHAR" />
    <result column="taskIndex" property="taskindex" jdbcType="INTEGER" />
    <result column="assignerUmId" property="assignerumid" jdbcType="VARCHAR" />
    <result column="assignerName" property="assignername" jdbcType="VARCHAR" />
    <result column="startTime" property="starttime" jdbcType="TIMESTAMP" />
    <result column="endTime" property="endtime" jdbcType="TIMESTAMP" />
    <result column="approve" property="approve" jdbcType="VARCHAR" />
    <result column="status" property="status" jdbcType="INTEGER" />
    <result column="statusName" property="statusName" jdbcType="INTEGER" />
     
    <result column="memo" property="memo" jdbcType="VARCHAR"/>
    <result column="MTime" property="mtime" jdbcType="TIMESTAMP" />
    <result column="CTime" property="ctime" jdbcType="TIMESTAMP" />
  </resultMap>
  <sql id="Base_Column_List" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    id, instanceId, taskId, taskCode, taskName, taskIndex, assignerUmId, assignerName, 
    startTime, endTime, approve, status, memo, MTime, 
    CTime
  </sql>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    select 
    <include refid="Base_Column_List" />
    from SYS_OA_TASK
    where id = #{id,jdbcType=BIGINT}
  </select>
  
   <select id="queryOaTask" resultMap="BaseResultMap" parameterType="com.td.admin.entity.SysOaTask" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    select <include refid="Base_Column_List" />
    ,(select title from SYS_OA_INSTANCE where id = instanceId ) as instanceName
    ,(select dicItemValue from SYS_DIC_ITEM where dicId=
			(select `id` from SYS_DIC where name='oaTaskStatus') and dicItemKey=SYS_OA_TASK.`status`) as statusName
    from SYS_OA_TASK
    where 1=1
    <if test="instancename != null and instancename !=''" >
       and instanceId in ((select SYS_OA_INSTANCE.id from SYS_OA_INSTANCE where title like CONCAT("%",#{instancename,jdbcType=VARCHAR},"%")))
    </if>
    <if test="taskname != null and taskname !=''" >
       and taskName like CONCAT("%",#{taskname,jdbcType=VARCHAR},"%")
    </if>
    <if test="approve==1" >
       and approve = 1
    </if>
    <if test="approve != null and approve!='' and approve==0">
        and (approve &lt;&gt; 1 or approve is null)
    </if>
    <if test="status != null and status !=''" >
       and status = #{status,jdbcType=INTEGER}
    </if>
    <if test="starttime != null">
		and startTime &gt;= #{starttime,jdbcType=TIMESTAMP}
	</if>
	<if test="findStartTime != null">
		and startTime &lt;= date_format(#{findStartTime,jdbcType=TIMESTAMP},'%Y-%c-%d 23:59:59') 
	</if>
	<if test="endtime != null">
		and endtime &gt;= #{endtime,jdbcType=TIMESTAMP}
	</if>
	<if test="findEndTime != null">
		and endtime &lt;= date_format(#{findEndTime,jdbcType=TIMESTAMP},'%Y-%c-%d 23:59:59') 
	</if>
	order by starttime desc
	limit #{beginIndex,jdbcType=BIGINT},#{numPerPage,jdbcType=BIGINT}
  </select>
     <select id="queryTotalCount" resultType="java.lang.Long" parameterType="com.td.admin.entity.SysOaTask" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    select 
    count(1)
    from SYS_OA_TASK
    where 1=1
    <if test="instancename != null and instancename !=''" >
       and instanceId in ((select SYS_OA_INSTANCE.id from SYS_OA_INSTANCE where title like CONCAT("%",#{instancename,jdbcType=VARCHAR},"%")))
    </if>
    <if test="taskname != null and taskname !=''" >
       and taskName like CONCAT("%",#{taskname,jdbcType=VARCHAR},"%")
    </if>
    <if test="approve==1" >
       and approve = 1
    </if>
    <if test="approve != null and approve!='' and approve==0">
        and (approve &lt;&gt; 1 or approve is null)
    </if>
    <if test="status != null and status !=''" >
       and status = #{status,jdbcType=INTEGER}
    </if>
    <if test="starttime != null">
		and startTime &gt;= #{starttime,jdbcType=TIMESTAMP}
	</if>
	<if test="findStartTime != null">
		and startTime &lt;= date_format(#{findStartTime,jdbcType=TIMESTAMP},'%Y-%c-%d 23:59:59') 
	</if>
	<if test="endtime != null">
		and endtime &gt;= #{endtime,jdbcType=TIMESTAMP}
	</if>
	<if test="findEndTime != null">
		and endtime &lt;= date_format(#{findEndTime,jdbcType=TIMESTAMP},'%Y-%c-%d 23:59:59') 
	</if>
  </select>
  
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    delete from SYS_OA_TASK
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="com.td.admin.entity.SysOaTask" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    insert into SYS_OA_TASK (id, instanceId, taskId, 
      taskCode, taskName, taskIndex, 
      assignerUmId, assignerName, startTime, 
      endTime, approve, status, 
      memo, MTime, CTime
      )
    values (#{id,jdbcType=BIGINT}, #{instanceid,jdbcType=BIGINT}, #{taskid,jdbcType=BIGINT}, 
      #{taskcode,jdbcType=VARCHAR}, #{taskname,jdbcType=VARCHAR}, #{taskindex,jdbcType=INTEGER}, 
      #{assignerumid,jdbcType=VARCHAR}, #{assignername,jdbcType=VARCHAR}, #{starttime,jdbcType=TIMESTAMP}, 
      #{endtime,jdbcType=TIMESTAMP}, #{approve,jdbcType=INTEGER}, #{status,jdbcType=INTEGER}, 
      #{memo,jdbcType=VARCHAR}, #{mtime,jdbcType=TIMESTAMP}, #{ctime,jdbcType=TIMESTAMP}
      )
  </insert>
  <insert id="insertSelective" parameterType="com.td.admin.entity.SysOaTask" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    insert into SYS_OA_TASK
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        id,
      </if>
      <if test="instanceid != null" >
        instanceId,
      </if>
      <if test="taskid != null" >
        taskId,
      </if>
      <if test="taskcode != null" >
        taskCode,
      </if>
      <if test="taskname != null" >
        taskName,
      </if>
      <if test="taskindex != null" >
        taskIndex,
      </if>
      <if test="assignerumid != null" >
        assignerUmId,
      </if>
      <if test="assignername != null" >
        assignerName,
      </if>
      <if test="starttime != null" >
        startTime,
      </if>
      <if test="endtime != null" >
        endTime,
      </if>
      <if test="approve != null" >
        approve,
      </if>
      <if test="status != null" >
        status,
      </if>
      <if test="memo != null" >
        memo,
      </if>
      <if test="mtime != null" >
        MTime,
      </if>
      <if test="ctime != null" >
        CTime,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="id != null" >
        #{id,jdbcType=BIGINT},
      </if>
      <if test="instanceid != null" >
        #{instanceid,jdbcType=BIGINT},
      </if>
      <if test="taskid != null" >
        #{taskid,jdbcType=BIGINT},
      </if>
      <if test="taskcode != null" >
        #{taskcode,jdbcType=VARCHAR},
      </if>
      <if test="taskname != null" >
        #{taskname,jdbcType=VARCHAR},
      </if>
      <if test="taskindex != null" >
        #{taskindex,jdbcType=INTEGER},
      </if>
      <if test="assignerumid != null" >
        #{assignerumid,jdbcType=VARCHAR},
      </if>
      <if test="assignername != null" >
        #{assignername,jdbcType=VARCHAR},
      </if>
      <if test="starttime != null" >
        #{starttime,jdbcType=TIMESTAMP},
      </if>
      <if test="endtime != null" >
        #{endtime,jdbcType=TIMESTAMP},
      </if>
      <if test="approve != null" >
        #{approve,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        #{status,jdbcType=INTEGER},
      </if>
      <if test="memo != null" >
        #{memo,jdbcType=VARCHAR},
      </if>
      <if test="mtime != null" >
        #{mtime,jdbcType=TIMESTAMP},
      </if>
      <if test="ctime != null" >
        #{ctime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.td.admin.entity.SysOaTask" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    update SYS_OA_TASK
    <set >
      <if test="instanceid != null" >
        instanceId = #{instanceid,jdbcType=BIGINT},
      </if>
      <if test="taskid != null" >
        taskId = #{taskid,jdbcType=BIGINT},
      </if>
      <if test="taskcode != null" >
        taskCode = #{taskcode,jdbcType=VARCHAR},
      </if>
      <if test="taskname != null" >
        taskName = #{taskname,jdbcType=VARCHAR},
      </if>
      <if test="taskindex != null" >
        taskIndex = #{taskindex,jdbcType=INTEGER},
      </if>
      <if test="assignerumid != null" >
        assignerUmId = #{assignerumid,jdbcType=VARCHAR},
      </if>
      <if test="assignername != null" >
        assignerName = #{assignername,jdbcType=VARCHAR},
      </if>
      <if test="starttime != null" >
        startTime = #{starttime,jdbcType=TIMESTAMP},
      </if>
      <if test="endtime != null" >
        endTime = #{endtime,jdbcType=TIMESTAMP},
      </if>
      <if test="approve != null" >
        approve = #{approve,jdbcType=INTEGER},
      </if>
      <if test="status != null" >
        status = #{status,jdbcType=INTEGER},
      </if>
      <if test="memo != null" >
        memo = #{memo,jdbcType=VARCHAR},
      </if>
      <if test="mtime != null" >
        MTime = #{mtime,jdbcType=TIMESTAMP},
      </if>
      <if test="ctime != null" >
        CTime = #{ctime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.td.admin.entity.SysOaTask" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Tue Aug 27 09:24:25 CST 2013.
    -->
    update SYS_OA_TASK
    set instanceId = #{instanceid,jdbcType=BIGINT},
      taskId = #{taskid,jdbcType=BIGINT},
      taskCode = #{taskcode,jdbcType=VARCHAR},
      taskName = #{taskname,jdbcType=VARCHAR},
      taskIndex = #{taskindex,jdbcType=INTEGER},
      assignerUmId = #{assignerumid,jdbcType=VARCHAR},
      assignerName = #{assignername,jdbcType=VARCHAR},
      startTime = #{starttime,jdbcType=TIMESTAMP},
      endTime = #{endtime,jdbcType=TIMESTAMP},
      approve = #{approve,jdbcType=INTEGER},
      status = #{status,jdbcType=INTEGER},
      memo = #{memo,jdbcType=VARCHAR},
      MTime = #{mtime,jdbcType=TIMESTAMP},
      CTime = #{ctime,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>
  
  
  <select id="getOaTask" parameterType="java.util.Map" resultMap="BaseResultMap">
  	select <include refid="Base_Column_List"/> from SYS_OA_TASK 
  	where taskId = #{taskId,jdbcType=BIGINT}
  </select>
  
  
  <select id="approveHistory" parameterType="java.util.Map" resultMap="BaseResultMap">
  	select <include refid="Base_Column_List"/> from SYS_OA_TASK
  	where instanceId = #{instanceId,jdbcType=VARCHAR} 
  	and taskId is not null and (status = 2 or  status = 3 or status = 4 or status = 7) order by taskIndex asc
  </select>
  <select id="getOaTaskByInstanceId" parameterType="com.td.admin.entity.SysOaTask" resultMap="BaseResultMap">
  	select <include refid="Base_Column_List"/> from SYS_OA_TASK
  	where instanceId = #{instanceid,jdbcType=BIGINT} 
  	order by taskIndex asc
  </select>

</mapper>